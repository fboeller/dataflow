<div *ngIf="formGroup$ | async as formGroup" [formGroup]="formGroup">
  <div class="w-full mb-2 p-4 bg-gray-300">
    <input
      class="w-full px-2 bg-gray-300 box-border border border-transparent hover:border-blue-400"
      type="text"
      formControlName="name"
      placeholder="Dataflow Name"
    />
  </div>
  <div class="flex flex-col gap-2">
    <app-step
      *ngFor="let step of steps(formGroup).controls; let stepIndex = index"
      [formGroup]="step"
      [evaluation]="(evaluations$ | async)[stepIndex]"
      [stepIndex]="stepIndex"
      (removed)="removeStep(formGroup, stepIndex)"
      (editRequested)="editStep(formGroup, stepIndex)"
    >
      <app-http-request
        *ngIf="step.get('request')"
        [formGroup]="step.get('request')"
        [evaluation]="(evaluations$ | async)[stepIndex]"
      ></app-http-request>
      <app-json-e-evaluation
        *ngIf="step.get('expression')"
        [formControl]="step.get('expression')"
        ngDefaultControl
      ></app-json-e-evaluation>
      <app-for-loop *ngIf="step.get('for')"></app-for-loop>
    </app-step>
  </div>
  <div class="grid gap-2 grid-cols-3 mt-2">
    <button
      class="p-4 bg-gray-300 hover:bg-gray-400"
      (click)="addRequestStep(formGroup)"
    >
      Add request step
    </button>
    <button
      class="p-4 bg-gray-300 hover:bg-gray-400"
      (click)="addEvaluationStep(formGroup)"
    >
      Add evaluation step
    </button>
    <button
      class="p-4 bg-gray-300 hover:bg-gray-400"
      (click)="addForLoopStep(formGroup)"
    >
      Add for loop
    </button>
  </div>
  <div class="flex gap-2 justify-end">
    <button
      class="mt-2 p-4 bg-red-500 hover:bg-red-600 text-white"
      *ngIf="execution$ | async"
      (click)="clearExecution()"
    >
      Clear execution
    </button>
    <button
      class="mt-2 p-4 bg-blue-600 hover:bg-blue-700 text-white"
      (click)="execute(formGroup)"
    >
      Execute
    </button>
    <button
      class="mt-2 p-4 bg-blue-600 hover:bg-blue-700 text-white"
      (click)="persist(formGroup)"
    >
      Persist
    </button>
  </div>
</div>
